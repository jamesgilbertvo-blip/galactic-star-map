<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galactic Star Map</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #111827; color: #d1d5db; font-family: 'Inter', sans-serif; }
        canvas { touch-action: none; cursor: grab; background-color: #1f2937; border-radius: 0.5rem; }
        canvas:active { cursor: grabbing; }
        .hidden { display: none; }
        input:focus, select:focus, textarea:focus { box-shadow: 0 0 0 2px #4f46e5; outline: none; }
        .logo-container { position: relative; display: flex; justify-content: center; align-items: center; margin-bottom: 1rem; }
        .logo-container img { width: 100px; height: 100px; z-index: 1; animation: float 6s ease-in-out infinite; }
        .logo-container::before { content: ''; position: absolute; width: 200px; height: 200px; background: radial-gradient(circle, rgba(56, 189, 248, 0.15), transparent 70%); border-radius: 50%; z-index: 0; }
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-10px); } 100% { transform: translateY(0px); } }
        #intel-context-menu { position: absolute; z-index: 50; min-width: 200px; }
    </style>
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
</head>
<body class="h-screen antialiased overflow-hidden relative">

    <div id="intel-context-menu" class="hidden bg-gray-800 border border-gray-700 rounded-lg shadow-xl p-4 flex-col space-y-3">
        <h3 id="intel-menu-title" class="text-sm font-bold text-white border-b border-gray-700 pb-2">Add Intel Marker</h3>
        <div class="text-xs text-gray-400" id="intel-coords-display"></div>
        <select id="intel-type-input" class="bg-gray-700 border border-gray-600 rounded text-white text-sm p-2">
            <option value="Mining Rich">Mining Rich</option>
            <option value="Hazard">Hazard</option>
            <option value="Point of Interest">Point of Interest</option>
        </select>
        <textarea id="intel-note-input" placeholder="Optional notes..." class="bg-gray-700 border border-gray-600 rounded text-white text-sm p-2 h-16 resize-none"></textarea>
        <div class="flex justify-between pt-2">
            <button id="delete-intel-btn" class="hidden px-3 py-1 text-xs bg-red-600 hover:bg-red-700 text-white rounded">Delete</button>
            <div class="flex space-x-2 ml-auto">
                <button id="cancel-intel-btn" class="px-3 py-1 text-xs text-gray-300 hover:text-white">Cancel</button>
                <button id="save-intel-btn" class="px-3 py-1 text-xs bg-indigo-600 hover:bg-indigo-700 text-white rounded">Save</button>
            </div>
        </div>
    </div>

    <div id="login-view" class="flex items-center justify-center h-full">
        <div class="w-full max-w-md p-8 space-y-8 bg-gray-900 rounded-lg shadow-lg">
            <div class="logo-container"><img src="/logo.png" alt="Galactic Star Map Logo"></div>
            <div><h2 class="text-3xl font-extrabold text-center text-white">Sign In</h2><p class="mt-2 text-sm text-center text-gray-400">to view your star map</p></div>
            <form id="login-form" class="mt-8 space-y-6">
                <div class="rounded-md shadow-sm -space-y-px"><input id="username" name="username" type="text" required class="relative block w-full px-3 py-2 text-white bg-gray-700 border border-gray-600 rounded-t-md placeholder-gray-400 focus:outline-none focus:ring-indigo-500" placeholder="Username"><input id="password" name="password" type="password" required class="relative block w-full px-3 py-2 text-white bg-gray-700 border border-gray-600 rounded-b-md placeholder-gray-400 focus:outline-none focus:ring-indigo-500" placeholder="Password"></div>
                <div><button type="submit" class="w-full px-4 py-2 text-sm font-medium text-white bg-indigo-600 rounded-md hover:bg-indigo-700">Sign in</button></div>
                <p id="login-error" class="text-sm text-center text-red-400 h-4" aria-live="assertive"></p>
            </form>
            <div class="text-sm text-center text-gray-400">
                <p>Don't have an account? <button id="show-register-view-button" class="font-medium text-indigo-400 hover:text-indigo-300">Register</button></p>
                <p class="mt-2">Need help? <a href="/guide.html" class="font-medium text-indigo-400 hover:text-indigo-300">Read the User Guide</a></p>
            </div>
        </div>
    </div>

    <div id="register-view" class="hidden flex items-center justify-center h-full">
        <div class="w-full max-w-md p-8 space-y-8 bg-gray-900 rounded-lg shadow-lg">
            <div class="logo-container"><img src="/logo.png" alt="Galactic Star Map Logo"></div>
            <div><h2 class="text-3xl font-extrabold text-center text-white">Create Account</h2><p class="mt-2 text-sm text-center text-gray-400">to start building your map</p></div>
            <form id="register-form" class="mt-8 space-y-6">
                <div class="rounded-md shadow-sm -space-y-px">
                    <input id="register-username" name="username" type="text" required class="w-full px-3 py-2 text-white bg-gray-700 border border-gray-600 rounded-t-md placeholder-gray-400 focus:outline-none focus:ring-indigo-500" placeholder="Username">
                    <input id="register-password" name="password" type="password" required class="w-full px-3 py-2 text-white bg-gray-700 border border-gray-600 placeholder-gray-400 focus:outline-none focus:ring-indigo-500" placeholder="Password">
                    <input id="register-api-key" name="api_key" type="text" required class="w-full px-3 py-2 text-white bg-gray-700 border border-gray-600 rounded-b-md placeholder-gray-400 focus:outline-none focus:ring-indigo-500" placeholder="Game API Key">
                </div>
                <p class="text-xs text-gray-400 text-center px-2">Please be aware that using an API key on any third-party service carries inherent security risks.</p>
                <div><button type="submit" class="w-full px-4 py-2 text-sm font-medium text-white bg-indigo-600 rounded-md hover:bg-indigo-700">Create Account</button></div>
                 <p id="register-error" class="text-sm text-center text-red-400 h-4" aria-live="assertive"></p>
            </form>
            <div class="text-sm text-center text-gray-400">
                <p>Already have an account? <button id="show-login-view-button" class="font-medium text-indigo-400 hover:text-indigo-300">Sign In</button></p>
                <p class="mt-2">Need help? <a href="/guide.html" class="font-medium text-indigo-400 hover:text-indigo-300">Read the User Guide</a></p>
            </div>
        </div>
    </div>

    <div id="profile-view" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50">
        <div class="w-full max-w-md p-8 space-y-6 bg-gray-900 rounded-lg shadow-lg">
            <div class="flex justify-between items-center"><h2 class="text-2xl font-bold text-white">Manage Profile</h2><button id="close-profile-button" class="text-gray-400 hover:text-white">&times;</button></div>
            <form id="profile-form" class="space-y-4">
                <div><label for="api-key-input" class="block text-sm font-medium text-gray-300">API Key</label><input id="api-key-input" type="text" class="w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-white focus:outline-none focus:ring-indigo-500" placeholder="Enter your game API key"></div>
                <div><label for="new-password-input" class="block text-sm font-medium text-gray-300">New Password (optional)</label><input id="new-password-input" type="password" class="w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-white focus:outline-none focus:ring-indigo-500" placeholder="Leave blank to keep current password"></div>
                <div><button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-md">Save Changes</button></div>
            </form>
            <div class="border-t border-gray-700 pt-4">
                <button id="bulk-sync-button" type="button" class="hidden w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md">One-Time Faction System Import</button>
                <p id="bulk-sync-text" class="hidden text-xs text-gray-400 text-center mt-2">Populate your map with all known Faction & POI systems.</p>
            </div>
            <p id="profile-status" class="text-sm text-center h-4" aria-live="assertive"></p>
        </div>
    </div>

    <div id="map-view" class="hidden flex h-screen overflow-hidden">
        <aside id="side-panel" class="absolute top-0 left-0 z-20 h-full w-full max-w-sm transform -translate-x-full transition-transform duration-300 ease-in-out md:relative md:max-w-xs md:translate-x-0 lg:max-w-sm bg-gray-900 p-6 flex-shrink-0 overflow-y-auto">
            <div class="space-y-6">
                <header class="flex items-center justify-between">
                    <div><h1 class="text-2xl font-bold text-white">Galactic Star Map</h1><p id="welcome-message" class="text-sm text-gray-400"></p></div>
                    <div id="user-controls" class="flex space-x-2">
                        <a href="/guide.html" class="px-3 py-1 text-sm font-medium text-white bg-gray-600 rounded-md hover:bg-gray-700">Guide</a>
                        <button id="profile-button" class="px-3 py-1 text-sm font-medium text-white bg-gray-600 rounded-md hover:bg-gray-700">Profile</button>
                        <button id="logout-button" class="px-3 py-1 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700">Logout</button>
                    </div>
                </header>
                <div id="sync-container" class="border-t border-b border-gray-700 py-4 space-y-3">
                    <button id="sync-button" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-md">Sync Map Data</button>
                    <p id="sync-status" class="text-sm text-center text-gray-400 mt-2 h-4" aria-live="assertive"></p>
                </div>
                <form id="route-form" class="space-y-4">
                    <div class="relative">
                        <label class="block text-xs text-gray-500 mb-1">Start</label>
                        <input type="text" id="start-system-input" list="system-list" class="route-input w-full bg-gray-700 border-gray-600 rounded-md py-2 px-3 text-white focus:outline-none focus:ring-indigo-500" placeholder="Start System or #Pos...">
                    </div>
                    <div id="waypoints-container" class="space-y-2"></div>
                    <button type="button" id="add-waypoint-btn" class="text-xs text-indigo-400 hover:text-indigo-300 flex items-center focus:outline-none">
                        <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                        Add Waypoint
                    </button>
                    <div class="relative">
                        <label class="block text-xs text-gray-500 mb-1">Destination</label>
                        <input type="text" id="end-system-input" list="system-list" class="route-input w-full bg-gray-700 border-gray-600 rounded-md py-2 px-3 text-white focus:outline-none focus:ring-indigo-500" placeholder="End System or #Pos...">
                    </div>
                    <datalist id="system-list"></datalist>
                    <div class="space-y-2 pt-2 border-t border-gray-700">
                        <div class="flex items-center">
                            <input id="filter-avoid-slow" type="checkbox" class="h-4 w-4 rounded border-gray-600 bg-gray-700 text-indigo-600 focus:ring-indigo-500">
                            <label for="filter-avoid-slow" class="ml-2 block text-sm text-gray-300">Avoid Slow Sublight Regions</label>
                        </div>
                        <div class="flex items-center">
                            <input id="filter-avoid-hostile" type="checkbox" class="h-4 w-4 rounded border-gray-600 bg-gray-700 text-indigo-600 focus:ring-indigo-500">
                            <label for="filter-avoid-hostile" class="ml-2 block text-sm text-gray-300">Avoid Hostile Systems</label>
                        </div>
                    </div>
                    <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-md">Find Shortest Path</button>
                </form>
                <div id="route-details" aria-live="polite" class="space-y-2"></div>
                
                <div class="border-t border-gray-700 pt-4 space-y-4">
                    <h3 class="text-lg font-semibold text-white">Search & Filters</h3>
                    <form id="search-form" class="space-y-2">
                        <input type="text" id="search-input" list="system-list" class="w-full bg-gray-700 border-gray-600 rounded-md py-2 px-3 text-white focus:outline-none focus:ring-indigo-500" placeholder="Find & Center on System...">
                        <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md text-sm">Search</button>
                    </form>
                    <div class="space-y-2">
                         <div class="flex items-center">
                             <input id="filter-catapults" type="checkbox" checked class="h-4 w-4 rounded border-gray-600 bg-gray-700 text-indigo-600 focus:ring-indigo-500">
                             <label for="filter-catapults" class="ml-2 block text-sm text-gray-300">Show Catapult Ranges</label>
                         </div>
                        <div class="flex items-center">
                             <input id="filter-wormholes" type="checkbox" checked class="h-4 w-4 rounded border-gray-600 bg-gray-700 text-indigo-600 focus:ring-indigo-500">
                             <label for="filter-wormholes" class="ml-2 block text-sm text-gray-300">Show Wormholes</label>
                        </div>
                    </div>
                </div>

                <div class="border-t border-gray-700 pt-4 space-y-2" aria-hidden="true">
                    <h3 class="text-lg font-semibold text-white">Display Options</h3>
                    <div class="flex items-center">
                        <input id="toggle-unclaimed-names" type="checkbox" class="h-4 w-4 rounded border-gray-600 bg-gray-700 text-indigo-600 focus:ring-indigo-500">
                        <label for="toggle-unclaimed-names" class="ml-2 block text-sm text-gray-300">Show Unclaimed Names</label>
                    </div>
                    <p class="text-xs text-gray-500">Click to select. Right-Click/Long-Press for Intel. Shift+Click to toggle range.</p>
                    <button id="reset-view-button" class="mt-2 w-full bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-md text-sm">Reset View</button>
                </div>
            </div>
        </aside>

        <main class="relative flex-grow flex items-center justify-center">
            <button id="menu-button" class="md:hidden absolute top-4 left-4 z-30 p-2 bg-gray-800 text-white rounded-md flex items-center space-x-2" title="Toggle Menu" aria-label="Toggle map controls panel" aria-controls="side-panel" aria-expanded="true">
                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                <span class="text-sm">Toggle Controls</span>
            </button>
            <button id="center-me-button" class="absolute bottom-4 right-4 z-10 p-2 bg-gray-800 text-white rounded-full shadow-lg" title="Center on last known location">
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M10 8a2 2 0 100-4 2 2 0 000 4z" /><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm0 2a10 10 0 100-20 10 10 0 000 20z" clip-rule="evenodd" /></svg>
            </button>
            <canvas id="map-canvas" class="w-full h-full"></canvas>
        </main>
    </div>
    
    <script type="module" src="/js/index.js"></script>

</body>
</html>